{"version":"tree-0.1","tree":{"id":"App","path":"","children":{"ValidationPipelineStack":{"id":"ValidationPipelineStack","path":"ValidationPipelineStack","children":{"ValidationVpc":{"id":"ValidationVpc","path":"ValidationPipelineStack/ValidationVpc","children":{"Resource":{"id":"Resource","path":"ValidationPipelineStack/ValidationVpc/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPC","aws:cdk:cloudformation:props":{"cidrBlock":"10.0.0.0/16","enableDnsHostnames":true,"enableDnsSupport":true,"instanceTenancy":"default","tags":[{"key":"Name","value":"ValidationPipelineStack/ValidationVpc"}]}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPC","version":"2.189.0"}},"PublicSubnet1":{"id":"PublicSubnet1","path":"ValidationPipelineStack/ValidationVpc/PublicSubnet1","children":{"Subnet":{"id":"Subnet","path":"ValidationPipelineStack/ValidationVpc/PublicSubnet1/Subnet","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Subnet","aws:cdk:cloudformation:props":{"availabilityZone":"us-east-1a","cidrBlock":"10.0.0.0/18","mapPublicIpOnLaunch":true,"tags":[{"key":"aws-cdk:subnet-name","value":"Public"},{"key":"aws-cdk:subnet-type","value":"Public"},{"key":"Name","value":"ValidationPipelineStack/ValidationVpc/PublicSubnet1"}],"vpcId":{"Ref":"ValidationVpcA7A6351A"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnet","version":"2.189.0"}},"Acl":{"id":"Acl","path":"ValidationPipelineStack/ValidationVpc/PublicSubnet1/Acl","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.189.0","metadata":[]}},"RouteTable":{"id":"RouteTable","path":"ValidationPipelineStack/ValidationVpc/PublicSubnet1/RouteTable","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::RouteTable","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"ValidationPipelineStack/ValidationVpc/PublicSubnet1"}],"vpcId":{"Ref":"ValidationVpcA7A6351A"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRouteTable","version":"2.189.0"}},"RouteTableAssociation":{"id":"RouteTableAssociation","path":"ValidationPipelineStack/ValidationVpc/PublicSubnet1/RouteTableAssociation","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SubnetRouteTableAssociation","aws:cdk:cloudformation:props":{"routeTableId":{"Ref":"ValidationVpcPublicSubnet1RouteTableFB109C3E"},"subnetId":{"Ref":"ValidationVpcPublicSubnet1Subnet77950CB6"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnetRouteTableAssociation","version":"2.189.0"}},"DefaultRoute":{"id":"DefaultRoute","path":"ValidationPipelineStack/ValidationVpc/PublicSubnet1/DefaultRoute","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Route","aws:cdk:cloudformation:props":{"destinationCidrBlock":"0.0.0.0/0","gatewayId":{"Ref":"ValidationVpcIGW93D4266F"},"routeTableId":{"Ref":"ValidationVpcPublicSubnet1RouteTableFB109C3E"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRoute","version":"2.189.0"}},"EIP":{"id":"EIP","path":"ValidationPipelineStack/ValidationVpc/PublicSubnet1/EIP","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::EIP","aws:cdk:cloudformation:props":{"domain":"vpc","tags":[{"key":"Name","value":"ValidationPipelineStack/ValidationVpc/PublicSubnet1"}]}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnEIP","version":"2.189.0"}},"NATGateway":{"id":"NATGateway","path":"ValidationPipelineStack/ValidationVpc/PublicSubnet1/NATGateway","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::NatGateway","aws:cdk:cloudformation:props":{"allocationId":{"Fn::GetAtt":["ValidationVpcPublicSubnet1EIP7E242C15","AllocationId"]},"subnetId":{"Ref":"ValidationVpcPublicSubnet1Subnet77950CB6"},"tags":[{"key":"Name","value":"ValidationPipelineStack/ValidationVpc/PublicSubnet1"}]}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnNatGateway","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.PublicSubnet","version":"2.189.0","metadata":[]}},"PublicSubnet2":{"id":"PublicSubnet2","path":"ValidationPipelineStack/ValidationVpc/PublicSubnet2","children":{"Subnet":{"id":"Subnet","path":"ValidationPipelineStack/ValidationVpc/PublicSubnet2/Subnet","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Subnet","aws:cdk:cloudformation:props":{"availabilityZone":"us-east-1b","cidrBlock":"10.0.64.0/18","mapPublicIpOnLaunch":true,"tags":[{"key":"aws-cdk:subnet-name","value":"Public"},{"key":"aws-cdk:subnet-type","value":"Public"},{"key":"Name","value":"ValidationPipelineStack/ValidationVpc/PublicSubnet2"}],"vpcId":{"Ref":"ValidationVpcA7A6351A"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnet","version":"2.189.0"}},"Acl":{"id":"Acl","path":"ValidationPipelineStack/ValidationVpc/PublicSubnet2/Acl","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.189.0","metadata":[]}},"RouteTable":{"id":"RouteTable","path":"ValidationPipelineStack/ValidationVpc/PublicSubnet2/RouteTable","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::RouteTable","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"ValidationPipelineStack/ValidationVpc/PublicSubnet2"}],"vpcId":{"Ref":"ValidationVpcA7A6351A"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRouteTable","version":"2.189.0"}},"RouteTableAssociation":{"id":"RouteTableAssociation","path":"ValidationPipelineStack/ValidationVpc/PublicSubnet2/RouteTableAssociation","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SubnetRouteTableAssociation","aws:cdk:cloudformation:props":{"routeTableId":{"Ref":"ValidationVpcPublicSubnet2RouteTable9271E6E2"},"subnetId":{"Ref":"ValidationVpcPublicSubnet2Subnet533BB13F"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnetRouteTableAssociation","version":"2.189.0"}},"DefaultRoute":{"id":"DefaultRoute","path":"ValidationPipelineStack/ValidationVpc/PublicSubnet2/DefaultRoute","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Route","aws:cdk:cloudformation:props":{"destinationCidrBlock":"0.0.0.0/0","gatewayId":{"Ref":"ValidationVpcIGW93D4266F"},"routeTableId":{"Ref":"ValidationVpcPublicSubnet2RouteTable9271E6E2"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRoute","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.PublicSubnet","version":"2.189.0","metadata":[]}},"PrivateSubnet1":{"id":"PrivateSubnet1","path":"ValidationPipelineStack/ValidationVpc/PrivateSubnet1","children":{"Subnet":{"id":"Subnet","path":"ValidationPipelineStack/ValidationVpc/PrivateSubnet1/Subnet","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Subnet","aws:cdk:cloudformation:props":{"availabilityZone":"us-east-1a","cidrBlock":"10.0.128.0/18","mapPublicIpOnLaunch":false,"tags":[{"key":"aws-cdk:subnet-name","value":"Private"},{"key":"aws-cdk:subnet-type","value":"Private"},{"key":"Name","value":"ValidationPipelineStack/ValidationVpc/PrivateSubnet1"}],"vpcId":{"Ref":"ValidationVpcA7A6351A"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnet","version":"2.189.0"}},"Acl":{"id":"Acl","path":"ValidationPipelineStack/ValidationVpc/PrivateSubnet1/Acl","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.189.0","metadata":[]}},"RouteTable":{"id":"RouteTable","path":"ValidationPipelineStack/ValidationVpc/PrivateSubnet1/RouteTable","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::RouteTable","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"ValidationPipelineStack/ValidationVpc/PrivateSubnet1"}],"vpcId":{"Ref":"ValidationVpcA7A6351A"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRouteTable","version":"2.189.0"}},"RouteTableAssociation":{"id":"RouteTableAssociation","path":"ValidationPipelineStack/ValidationVpc/PrivateSubnet1/RouteTableAssociation","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SubnetRouteTableAssociation","aws:cdk:cloudformation:props":{"routeTableId":{"Ref":"ValidationVpcPrivateSubnet1RouteTable47424F2C"},"subnetId":{"Ref":"ValidationVpcPrivateSubnet1Subnet4675042B"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnetRouteTableAssociation","version":"2.189.0"}},"DefaultRoute":{"id":"DefaultRoute","path":"ValidationPipelineStack/ValidationVpc/PrivateSubnet1/DefaultRoute","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Route","aws:cdk:cloudformation:props":{"destinationCidrBlock":"0.0.0.0/0","natGatewayId":{"Ref":"ValidationVpcPublicSubnet1NATGatewayE2AF8DDB"},"routeTableId":{"Ref":"ValidationVpcPrivateSubnet1RouteTable47424F2C"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRoute","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.PrivateSubnet","version":"2.189.0","metadata":[]}},"PrivateSubnet2":{"id":"PrivateSubnet2","path":"ValidationPipelineStack/ValidationVpc/PrivateSubnet2","children":{"Subnet":{"id":"Subnet","path":"ValidationPipelineStack/ValidationVpc/PrivateSubnet2/Subnet","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Subnet","aws:cdk:cloudformation:props":{"availabilityZone":"us-east-1b","cidrBlock":"10.0.192.0/18","mapPublicIpOnLaunch":false,"tags":[{"key":"aws-cdk:subnet-name","value":"Private"},{"key":"aws-cdk:subnet-type","value":"Private"},{"key":"Name","value":"ValidationPipelineStack/ValidationVpc/PrivateSubnet2"}],"vpcId":{"Ref":"ValidationVpcA7A6351A"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnet","version":"2.189.0"}},"Acl":{"id":"Acl","path":"ValidationPipelineStack/ValidationVpc/PrivateSubnet2/Acl","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.189.0","metadata":[]}},"RouteTable":{"id":"RouteTable","path":"ValidationPipelineStack/ValidationVpc/PrivateSubnet2/RouteTable","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::RouteTable","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"ValidationPipelineStack/ValidationVpc/PrivateSubnet2"}],"vpcId":{"Ref":"ValidationVpcA7A6351A"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRouteTable","version":"2.189.0"}},"RouteTableAssociation":{"id":"RouteTableAssociation","path":"ValidationPipelineStack/ValidationVpc/PrivateSubnet2/RouteTableAssociation","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SubnetRouteTableAssociation","aws:cdk:cloudformation:props":{"routeTableId":{"Ref":"ValidationVpcPrivateSubnet2RouteTable2C792194"},"subnetId":{"Ref":"ValidationVpcPrivateSubnet2Subnet9B94DBBC"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnetRouteTableAssociation","version":"2.189.0"}},"DefaultRoute":{"id":"DefaultRoute","path":"ValidationPipelineStack/ValidationVpc/PrivateSubnet2/DefaultRoute","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Route","aws:cdk:cloudformation:props":{"destinationCidrBlock":"0.0.0.0/0","natGatewayId":{"Ref":"ValidationVpcPublicSubnet1NATGatewayE2AF8DDB"},"routeTableId":{"Ref":"ValidationVpcPrivateSubnet2RouteTable2C792194"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRoute","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.PrivateSubnet","version":"2.189.0","metadata":[]}},"IGW":{"id":"IGW","path":"ValidationPipelineStack/ValidationVpc/IGW","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::InternetGateway","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"ValidationPipelineStack/ValidationVpc"}]}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnInternetGateway","version":"2.189.0"}},"VPCGW":{"id":"VPCGW","path":"ValidationPipelineStack/ValidationVpc/VPCGW","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPCGatewayAttachment","aws:cdk:cloudformation:props":{"internetGatewayId":{"Ref":"ValidationVpcIGW93D4266F"},"vpcId":{"Ref":"ValidationVpcA7A6351A"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPCGatewayAttachment","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.Vpc","version":"2.189.0","metadata":[]}},"EcsSecurityGroup":{"id":"EcsSecurityGroup","path":"ValidationPipelineStack/EcsSecurityGroup","children":{"Resource":{"id":"Resource","path":"ValidationPipelineStack/EcsSecurityGroup/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"Security group for MCP Server validation tasks","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"securityGroupIngress":[{"cidrIp":"0.0.0.0/0","ipProtocol":"tcp","fromPort":8000,"toPort":8000,"description":"Allow MCP server traffic"}],"vpcId":{"Ref":"ValidationVpcA7A6351A"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.189.0","metadata":[]}},"MCPServerRepo":{"id":"MCPServerRepo","path":"ValidationPipelineStack/MCPServerRepo","children":{"Resource":{"id":"Resource","path":"ValidationPipelineStack/MCPServerRepo/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::ECR::Repository","aws:cdk:cloudformation:props":{"lifecyclePolicy":{"lifecyclePolicyText":"{\"rules\":[{\"rulePriority\":1,\"description\":\"Keep only the last 100 images\",\"selection\":{\"tagStatus\":\"any\",\"countType\":\"imageCountMoreThan\",\"countNumber\":100},\"action\":{\"type\":\"expire\"}}]}"},"repositoryName":"toolshed-mcp-servers-v2"}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.CfnRepository","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.Repository","version":"2.189.0","metadata":[]}},"GitHubToken":{"id":"GitHubToken","path":"ValidationPipelineStack/GitHubToken","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.189.0","metadata":[]}},"DockerHubCredentials":{"id":"DockerHubCredentials","path":"ValidationPipelineStack/DockerHubCredentials","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.189.0","metadata":[]}},"MCPServerBuild":{"id":"MCPServerBuild","path":"ValidationPipelineStack/MCPServerBuild","children":{"Role":{"id":"Role","path":"ValidationPipelineStack/MCPServerBuild/Role","children":{"ImportRole":{"id":"ImportRole","path":"ValidationPipelineStack/MCPServerBuild/Role/ImportRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.189.0","metadata":[]}},"Resource":{"id":"Resource","path":"ValidationPipelineStack/MCPServerBuild/Role/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"codebuild.amazonaws.com"}}],"Version":"2012-10-17"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.189.0"}},"DefaultPolicy":{"id":"DefaultPolicy","path":"ValidationPipelineStack/MCPServerBuild/Role/DefaultPolicy","children":{"Resource":{"id":"Resource","path":"ValidationPipelineStack/MCPServerBuild/Role/DefaultPolicy/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"secretsmanager:GetSecretValue","Effect":"Allow","Resource":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":secretsmanager:us-east-1:277502524328:secret:toolshed/github-token*"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":secretsmanager:us-east-1:277502524328:secret:toolshed/dockerhub-credentials*"]]}]},{"Action":["logs:CreateLogGroup","logs:CreateLogStream","logs:PutLogEvents"],"Effect":"Allow","Resource":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":logs:us-east-1:277502524328:log-group:/aws/codebuild/",{"Ref":"MCPServerBuild453D3FD6"}]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":logs:us-east-1:277502524328:log-group:/aws/codebuild/",{"Ref":"MCPServerBuild453D3FD6"},":*"]]}]},{"Action":["codebuild:CreateReportGroup","codebuild:CreateReport","codebuild:UpdateReport","codebuild:BatchPutTestCases","codebuild:BatchPutCodeCoverages"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":codebuild:us-east-1:277502524328:report-group/",{"Ref":"MCPServerBuild453D3FD6"},"-*"]]}},{"Action":["ecr:BatchCheckLayerAvailability","ecr:GetDownloadUrlForLayer","ecr:BatchGetImage","ecr:CompleteLayerUpload","ecr:UploadLayerPart","ecr:InitiateLayerUpload","ecr:PutImage"],"Effect":"Allow","Resource":{"Fn::GetAtt":["MCPServerRepoA6EF8A41","Arn"]}},{"Action":"ecr:GetAuthorizationToken","Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"MCPServerBuildRoleDefaultPolicyB2C02169","roles":[{"Ref":"MCPServerBuildRole28056180"}]}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.189.0","metadata":[]}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.189.0","metadata":[]}},"Resource":{"id":"Resource","path":"ValidationPipelineStack/MCPServerBuild/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::CodeBuild::Project","aws:cdk:cloudformation:props":{"artifacts":{"type":"NO_ARTIFACTS"},"cache":{"type":"NO_CACHE"},"description":"Builds Docker images for MCP servers","encryptionKey":"alias/aws/s3","environment":{"type":"LINUX_CONTAINER","image":"aws/codebuild/amazonlinux2-x86_64-standard:4.0","imagePullCredentialsType":"CODEBUILD","privilegedMode":true,"computeType":"BUILD_GENERAL1_SMALL","environmentVariables":[{"name":"REPOSITORY_URI","type":"PLAINTEXT","value":{"Fn::Join":["",[{"Fn::Select":[4,{"Fn::Split":[":",{"Fn::GetAtt":["MCPServerRepoA6EF8A41","Arn"]}]}]},".dkr.ecr.",{"Fn::Select":[3,{"Fn::Split":[":",{"Fn::GetAtt":["MCPServerRepoA6EF8A41","Arn"]}]}]},".",{"Ref":"AWS::URLSuffix"},"/",{"Ref":"MCPServerRepoA6EF8A41"}]]}},{"name":"GITHUB_TOKEN","type":"SECRETS_MANAGER","value":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":secretsmanager:us-east-1:277502524328:secret:toolshed/github-token"]]}},{"name":"DOCKERHUB_USERNAME","type":"SECRETS_MANAGER","value":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":secretsmanager:us-east-1:277502524328:secret:toolshed/dockerhub-credentials:username"]]}},{"name":"DOCKERHUB_TOKEN","type":"SECRETS_MANAGER","value":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":secretsmanager:us-east-1:277502524328:secret:toolshed/dockerhub-credentials:token"]]}},{"name":"DOCKER_BUILDKIT","type":"PLAINTEXT","value":"1"}]},"name":"ToolShed-MCP-Server-Build","serviceRole":{"Fn::GetAtt":["MCPServerBuildRole28056180","Arn"]},"source":{"type":"NO_SOURCE","buildSpec":"{\n  \"version\": \"0.2\",\n  \"phases\": {\n    \"pre_build\": {\n      \"commands\": [\n        \"echo Logging in to Amazon ECR...\",\n        \"aws ecr get-login-password --region $AWS_DEFAULT_REGION | docker login --username AWS --password-stdin $REPOSITORY_URI\",\n        \"echo Logging in to Docker Hub...\",\n        \"echo $DOCKERHUB_TOKEN | docker login -u $DOCKERHUB_USERNAME --password-stdin\",\n        \"REPO_URL=$(echo $CODEBUILD_INITIATOR | cut -d/ -f2)\",\n        \"REPO_NAME=$(echo $REPO_URL | cut -d@ -f1)\",\n        \"echo \\\"Original repository name: $ORIGINAL_REPOSITORY_NAME\\\"\",\n        \"TIMESTAMP=$(date +%Y%m%d%H%M%S)\",\n        \"echo \\\"Create a sanitized image tag name (replace slashes with dashes)\\\"\",\n        \"SANITIZED_REPO_NAME=$(echo $REPOSITORY_NAME | tr \\\"/\\\" \\\"-\\\")\",\n        \"echo \\\"Use timestamp as fallback if CODEBUILD_RESOLVED_SOURCE_VERSION is empty\\\"\",\n        \"SOURCE_VERSION=${CODEBUILD_RESOLVED_SOURCE_VERSION:-$TIMESTAMP}\",\n        \"echo \\\"Important: Do not include a colon in IMAGE_TAG as it will be used in $REPOSITORY_URI:$IMAGE_TAG\\\"\",\n        \"IMAGE_TAG=\\\"${SANITIZED_REPO_NAME}-${SOURCE_VERSION}\\\"\",\n        \"echo \\\"Using image tag: $IMAGE_TAG\\\"\"\n      ]\n    },\n    \"build\": {\n      \"commands\": [\n        \"echo Cloning repository...\",\n        \"echo \\\"Using repository name: $REPOSITORY_NAME\\\"\",\n        \"echo \\\"Using original repository name: $ORIGINAL_REPOSITORY_NAME\\\"\",\n        \"echo \\\"Using server ID: $SERVER_ID\\\"\",\n        \"echo \\\"Always use the ORIGINAL_REPOSITORY_NAME for git clone as it has the correct format with slashes\\\"\",\n        \"echo \\\"Cloning from: $ORIGINAL_REPOSITORY_NAME\\\"\",\n        \"git clone \\\"https://$GITHUB_TOKEN@github.com/$ORIGINAL_REPOSITORY_NAME.git\\\" repo\",\n        \"cd repo\",\n        \"echo Building the Docker image...\",\n        \"echo \\\"Docker image tag: $REPOSITORY_URI:$IMAGE_TAG\\\"\",\n        \"echo \\\"Enabling Docker BuildKit explicitly...\\\"\",\n        \"export DOCKER_BUILDKIT=1\",\n        \"export DOCKER_BUILDX_EXPERIMENTAL=1\",\n        \"docker buildx install || echo \\\"Buildx already installed\\\"\",\n        \"docker buildx create --use --name codebuild_builder || echo \\\"Builder exists or couldn't be created\\\"\",\n        \"echo \\\"Checking Dockerfile for BuildKit-specific directives...\\\"\",\n        \"if grep -q \\\"\\\\-\\\\-mount=type=cache\\\" Dockerfile; then echo \\\"BuildKit cache mount found, creating compatible version\\\"; cp Dockerfile Dockerfile.original; sed \\\"s/RUN --mount=type=cache/RUN/\\\" Dockerfile > Dockerfile.nobuildkit; fi\",\n        \"docker buildx build --progress=plain -t $REPOSITORY_URI:$IMAGE_TAG . || (echo \\\"Docker buildx build failed, trying legacy build without cache...\\\"; docker build --no-cache -t $REPOSITORY_URI:$IMAGE_TAG . || (echo \\\"Docker build failed, checking if we need to use modified Dockerfile...\\\"; if [ -f Dockerfile.nobuildkit ]; then echo \\\"Trying build with BuildKit-compatible Dockerfile\\\"; docker build -f Dockerfile.nobuildkit -t $REPOSITORY_URI:$IMAGE_TAG . || (echo \\\"All build attempts failed, showing Dockerfile\\\"; cat Dockerfile; exit 1); else echo \\\"No BuildKit directives found to modify. Build failed.\\\"; cat Dockerfile; exit 1; fi))\",\n        \"docker tag $REPOSITORY_URI:$IMAGE_TAG $REPOSITORY_URI:latest\"\n      ]\n    },\n    \"post_build\": {\n      \"commands\": [\n        \"echo Pushing the Docker image...\",\n        \"docker push $REPOSITORY_URI:$IMAGE_TAG || (echo \\\"Docker push failed, verifying image exists...\\\"; docker images; exit 1)\",\n        \"docker push $REPOSITORY_URI:latest || echo \\\"Warning: Failed to push latest tag, but build ID tag was pushed successfully\\\"\",\n        \"echo Writing image definition file...\",\n        \"echo \\\"{\\\"imageUri\\\":\\\"$REPOSITORY_URI:$IMAGE_TAG\\\",\\\"serverId\\\":\\\"$SERVER_ID\\\"}\\\" > imageDefinition.json\"\n      ]\n    }\n  },\n  \"artifacts\": {\n    \"files\": [\n      \"imageDefinition.json\"\n    ]\n  }\n}"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_codebuild.CfnProject","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_codebuild.Project","version":"2.189.0","metadata":[]}},"ValidationCluster":{"id":"ValidationCluster","path":"ValidationPipelineStack/ValidationCluster","children":{"Resource":{"id":"Resource","path":"ValidationPipelineStack/ValidationCluster/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::ECS::Cluster","aws:cdk:cloudformation:props":{"clusterName":"ToolShed-Validation-Cluster"}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.CfnCluster","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.Cluster","version":"2.189.0","metadata":[]}},"MCPServerTaskRole":{"id":"MCPServerTaskRole","path":"ValidationPipelineStack/MCPServerTaskRole","children":{"ImportMCPServerTaskRole":{"id":"ImportMCPServerTaskRole","path":"ValidationPipelineStack/MCPServerTaskRole/ImportMCPServerTaskRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.189.0","metadata":[]}},"Resource":{"id":"Resource","path":"ValidationPipelineStack/MCPServerTaskRole/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ecs-tasks.amazonaws.com"}}],"Version":"2012-10-17"},"description":"Role for MCP server tasks","roleName":"ToolShed-Validation-MCP-Server-Task-Role"}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.189.0","metadata":[]}},"MCPServerExecutionRole":{"id":"MCPServerExecutionRole","path":"ValidationPipelineStack/MCPServerExecutionRole","children":{"ImportMCPServerExecutionRole":{"id":"ImportMCPServerExecutionRole","path":"ValidationPipelineStack/MCPServerExecutionRole/ImportMCPServerExecutionRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.189.0","metadata":[]}},"Resource":{"id":"Resource","path":"ValidationPipelineStack/MCPServerExecutionRole/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ecs-tasks.amazonaws.com"}}],"Version":"2012-10-17"},"description":"Execution role for MCP server tasks","managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"]]}],"roleName":"ToolShed-Validation-MCP-Server-Execution-Role"}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.189.0"}},"DefaultPolicy":{"id":"DefaultPolicy","path":"ValidationPipelineStack/MCPServerExecutionRole/DefaultPolicy","children":{"Resource":{"id":"Resource","path":"ValidationPipelineStack/MCPServerExecutionRole/DefaultPolicy/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["ecr:BatchCheckLayerAvailability","ecr:GetDownloadUrlForLayer","ecr:BatchGetImage"],"Effect":"Allow","Resource":{"Fn::GetAtt":["MCPServerRepoA6EF8A41","Arn"]}},{"Action":"ecr:GetAuthorizationToken","Effect":"Allow","Resource":"*"},{"Action":["logs:CreateLogStream","logs:PutLogEvents"],"Effect":"Allow","Resource":{"Fn::GetAtt":["MCPServerTaskDefMCPServerContainerLogGroupE8AA777F","Arn"]}}],"Version":"2012-10-17"},"policyName":"MCPServerExecutionRoleDefaultPolicy8092073E","roles":[{"Ref":"MCPServerExecutionRole42C2B8D9"}]}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.189.0","metadata":[]}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.189.0","metadata":[]}},"MCPServerTaskDef":{"id":"MCPServerTaskDef","path":"ValidationPipelineStack/MCPServerTaskDef","children":{"Resource":{"id":"Resource","path":"ValidationPipelineStack/MCPServerTaskDef/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::ECS::TaskDefinition","aws:cdk:cloudformation:props":{"containerDefinitions":[{"essential":true,"image":"amazon/amazon-ecs-sample","name":"MCPServerContainer","portMappings":[{"containerPort":8000,"hostPort":8000,"protocol":"tcp"}],"logConfiguration":{"logDriver":"awslogs","options":{"awslogs-group":{"Ref":"MCPServerTaskDefMCPServerContainerLogGroupE8AA777F"},"awslogs-stream-prefix":"mcp-server","awslogs-region":"us-east-1"}}}],"cpu":"256","executionRoleArn":{"Fn::GetAtt":["MCPServerExecutionRole42C2B8D9","Arn"]},"family":"ValidationPipelineStackMCPServerTaskDef80539BDE","memory":"512","networkMode":"awsvpc","requiresCompatibilities":["FARGATE"],"taskRoleArn":{"Fn::GetAtt":["MCPServerTaskRoleACEA80B3","Arn"]}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.CfnTaskDefinition","version":"2.189.0"}},"MCPServerContainer":{"id":"MCPServerContainer","path":"ValidationPipelineStack/MCPServerTaskDef/MCPServerContainer","children":{"LogGroup":{"id":"LogGroup","path":"ValidationPipelineStack/MCPServerTaskDef/MCPServerContainer/LogGroup","children":{"Resource":{"id":"Resource","path":"ValidationPipelineStack/MCPServerTaskDef/MCPServerContainer/LogGroup/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"retentionInDays":7}},"constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.189.0","metadata":[]}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.ContainerDefinition","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.FargateTaskDefinition","version":"2.189.0","metadata":[]}},"ValidationFunction":{"id":"ValidationFunction","path":"ValidationPipelineStack/ValidationFunction","children":{"ServiceRole":{"id":"ServiceRole","path":"ValidationPipelineStack/ValidationFunction/ServiceRole","children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"ValidationPipelineStack/ValidationFunction/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.189.0","metadata":[]}},"Resource":{"id":"Resource","path":"ValidationPipelineStack/ValidationFunction/ServiceRole/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole"]]}]}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.189.0"}},"DefaultPolicy":{"id":"DefaultPolicy","path":"ValidationPipelineStack/ValidationFunction/ServiceRole/DefaultPolicy","children":{"Resource":{"id":"Resource","path":"ValidationPipelineStack/ValidationFunction/ServiceRole/DefaultPolicy/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["dynamodb:GetItem","dynamodb:UpdateItem","dynamodb:PutItem"],"Effect":"Allow","Resource":"arn:aws:dynamodb:us-east-1:277502524328:table/ToolShedServers"}],"Version":"2012-10-17"},"policyName":"ValidationFunctionServiceRoleDefaultPolicyE32E5084","roles":[{"Ref":"ValidationFunctionServiceRole934D0B98"}]}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.189.0","metadata":[]}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.189.0","metadata":[]}},"Code":{"id":"Code","path":"ValidationPipelineStack/ValidationFunction/Code","children":{"Stage":{"id":"Stage","path":"ValidationPipelineStack/ValidationFunction/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.189.0"}},"AssetBucket":{"id":"AssetBucket","path":"ValidationPipelineStack/ValidationFunction/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.189.0","metadata":[]}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.189.0"}},"Resource":{"id":"Resource","path":"ValidationPipelineStack/ValidationFunction/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-277502524328-us-east-1","s3Key":"5faea8dee4958bafc7c6f9bfd2f0d146bb11f7d4a73ba9e5aecb65f222dba63c.zip"},"environment":{"variables":{"DYNAMODB_TABLE":"ToolShedServers"}},"functionName":"ToolShed-MCP-Server-Validation","handler":"index.handler","memorySize":512,"role":{"Fn::GetAtt":["ValidationFunctionServiceRole934D0B98","Arn"]},"runtime":"nodejs18.x","timeout":300,"vpcConfig":{"subnetIds":[{"Ref":"ValidationVpcPrivateSubnet1Subnet4675042B"},{"Ref":"ValidationVpcPrivateSubnet2Subnet9B94DBBC"}],"securityGroupIds":[{"Fn::GetAtt":["EcsSecurityGroup44008BF1","GroupId"]}]}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.189.0","metadata":[]}},"BuildMCPServerImage":{"id":"BuildMCPServerImage","path":"ValidationPipelineStack/BuildMCPServerImage","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.CodeBuildStartBuild","version":"2.189.0"}},"ParseImageUri":{"id":"ParseImageUri","path":"ValidationPipelineStack/ParseImageUri","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Pass","version":"2.189.0"}},"RunMCPServerContainer":{"id":"RunMCPServerContainer","path":"ValidationPipelineStack/RunMCPServerContainer","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.EcsRunTask","version":"2.189.0"}},"ValidateMCPServer":{"id":"ValidateMCPServer","path":"ValidationPipelineStack/ValidateMCPServer","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.LambdaInvoke","version":"2.189.0"}},"StopTaskFunction":{"id":"StopTaskFunction","path":"ValidationPipelineStack/StopTaskFunction","children":{"ServiceRole":{"id":"ServiceRole","path":"ValidationPipelineStack/StopTaskFunction/ServiceRole","children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"ValidationPipelineStack/StopTaskFunction/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.189.0","metadata":[]}},"Resource":{"id":"Resource","path":"ValidationPipelineStack/StopTaskFunction/ServiceRole/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.189.0"}},"DefaultPolicy":{"id":"DefaultPolicy","path":"ValidationPipelineStack/StopTaskFunction/ServiceRole/DefaultPolicy","children":{"Resource":{"id":"Resource","path":"ValidationPipelineStack/StopTaskFunction/ServiceRole/DefaultPolicy/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"ecs:StopTask","Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"StopTaskFunctionServiceRoleDefaultPolicyA75E149A","roles":[{"Ref":"StopTaskFunctionServiceRole403B9068"}]}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.189.0","metadata":[]}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.189.0","metadata":[]}},"Resource":{"id":"Resource","path":"ValidationPipelineStack/StopTaskFunction/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\n        const { ECSClient, StopTaskCommand } = require(\"@aws-sdk/client-ecs\");\n        \n        exports.handler = async (event) => {\n          const ecsClient = new ECSClient({ region: process.env.AWS_REGION });\n          \n          try {\n            const stopTaskCommand = new StopTaskCommand({\n              cluster: process.env.CLUSTER_ARN,\n              task: event.taskArn,\n              reason: 'Stopped by Step Functions'\n            });\n            \n            await ecsClient.send(stopTaskCommand);\n            \n            return { \n              success: true, \n              taskArn: event.taskArn \n            };\n          } catch (error) {\n            console.error('Error stopping task:', error);\n            throw error;\n          }\n        }\n      "},"environment":{"variables":{"CLUSTER_ARN":{"Fn::GetAtt":["ValidationClusterC8915CA8","Arn"]}}},"functionName":"ToolShed-Stop-ECS-Task","handler":"index.handler","role":{"Fn::GetAtt":["StopTaskFunctionServiceRole403B9068","Arn"]},"runtime":"nodejs18.x","timeout":30}},"constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.189.0","metadata":[]}},"StopMCPServerContainer":{"id":"StopMCPServerContainer","path":"ValidationPipelineStack/StopMCPServerContainer","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.LambdaInvoke","version":"2.189.0"}},"ValidationSucceeded":{"id":"ValidationSucceeded","path":"ValidationPipelineStack/ValidationSucceeded","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Succeed","version":"2.189.0"}},"ValidationFailed":{"id":"ValidationFailed","path":"ValidationPipelineStack/ValidationFailed","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Fail","version":"2.189.0"}},"CheckValidationResult":{"id":"CheckValidationResult","path":"ValidationPipelineStack/CheckValidationResult","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Choice","version":"2.189.0"}},"ValidationPipeline":{"id":"ValidationPipeline","path":"ValidationPipelineStack/ValidationPipeline","children":{"Role":{"id":"Role","path":"ValidationPipelineStack/ValidationPipeline/Role","children":{"ImportRole":{"id":"ImportRole","path":"ValidationPipelineStack/ValidationPipeline/Role/ImportRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.189.0","metadata":[]}},"Resource":{"id":"Resource","path":"ValidationPipelineStack/ValidationPipeline/Role/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"states.amazonaws.com"}}],"Version":"2012-10-17"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.189.0"}},"DefaultPolicy":{"id":"DefaultPolicy","path":"ValidationPipelineStack/ValidationPipeline/Role/DefaultPolicy","children":{"Resource":{"id":"Resource","path":"ValidationPipelineStack/ValidationPipeline/Role/DefaultPolicy/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["codebuild:StartBuild","codebuild:StopBuild","codebuild:BatchGetBuilds","codebuild:BatchGetReports"],"Effect":"Allow","Resource":{"Fn::GetAtt":["MCPServerBuild453D3FD6","Arn"]}},{"Action":["events:PutTargets","events:PutRule","events:DescribeRule"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":events:us-east-1:277502524328:rule/StepFunctionsGetEventForCodeBuildStartBuildRule"]]}},{"Action":"ecs:RunTask","Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Fn::Select":[1,{"Fn::Split":[":",{"Ref":"MCPServerTaskDefDBB4F7C0"}]}]},":",{"Fn::Select":[2,{"Fn::Split":[":",{"Ref":"MCPServerTaskDefDBB4F7C0"}]}]},":",{"Fn::Select":[3,{"Fn::Split":[":",{"Ref":"MCPServerTaskDefDBB4F7C0"}]}]},":",{"Fn::Select":[4,{"Fn::Split":[":",{"Ref":"MCPServerTaskDefDBB4F7C0"}]}]},":",{"Fn::Select":[0,{"Fn::Split":["/",{"Fn::Select":[5,{"Fn::Split":[":",{"Ref":"MCPServerTaskDefDBB4F7C0"}]}]}]}]},"/",{"Fn::Select":[1,{"Fn::Split":["/",{"Fn::Select":[5,{"Fn::Split":[":",{"Ref":"MCPServerTaskDefDBB4F7C0"}]}]}]}]},":*"]]}},{"Action":["ecs:StopTask","ecs:DescribeTasks"],"Effect":"Allow","Resource":"*"},{"Action":"iam:PassRole","Effect":"Allow","Resource":[{"Fn::GetAtt":["MCPServerTaskRoleACEA80B3","Arn"]},{"Fn::GetAtt":["MCPServerExecutionRole42C2B8D9","Arn"]}]},{"Action":["events:PutTargets","events:PutRule","events:DescribeRule"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":events:us-east-1:277502524328:rule/StepFunctionsGetEventsForECSTaskRule"]]}},{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["ValidationFunctionB150DCA9","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ValidationFunctionB150DCA9","Arn"]},":*"]]}]},{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["StopTaskFunction11473A8C","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["StopTaskFunction11473A8C","Arn"]},":*"]]}]},{"Action":["xray:PutTraceSegments","xray:PutTelemetryRecords","xray:GetSamplingRules","xray:GetSamplingTargets"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"ValidationPipelineRoleDefaultPolicy14E6A436","roles":[{"Ref":"ValidationPipelineRole502F3E50"}]}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.189.0","metadata":[]}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.189.0","metadata":[]}},"Resource":{"id":"Resource","path":"ValidationPipelineStack/ValidationPipeline/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::StepFunctions::StateMachine","aws:cdk:cloudformation:props":{"definitionString":{"Fn::Join":["",["{\"StartAt\":\"BuildMCPServerImage\",\"States\":{\"BuildMCPServerImage\":{\"Next\":\"ParseImageUri\",\"Type\":\"Task\",\"ResultPath\":\"$.buildResult\",\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::codebuild:startBuild.sync\",\"Parameters\":{\"ProjectName\":\"",{"Ref":"MCPServerBuild453D3FD6"},"\",\"EnvironmentVariablesOverride\":[{\"Name\":\"REPOSITORY_NAME\",\"Type\":\"PLAINTEXT\",\"Value.$\":\"$.repositoryName\"},{\"Name\":\"ORIGINAL_REPOSITORY_NAME\",\"Type\":\"PLAINTEXT\",\"Value.$\":\"$.originalRepositoryName\"},{\"Name\":\"SERVER_ID\",\"Type\":\"PLAINTEXT\",\"Value.$\":\"$.serverId\"}]}},\"ParseImageUri\":{\"Type\":\"Pass\",\"ResultPath\":\"$.imageDetails\",\"Parameters\":{\"imageUri.$\":\"$.buildResult.Build.Artifacts.Location\",\"serverId.$\":\"$.serverId\"},\"Next\":\"RunMCPServerContainer\"},\"RunMCPServerContainer\":{\"Next\":\"ValidateMCPServer\",\"Type\":\"Task\",\"ResultPath\":\"$.taskResult\",\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::ecs:runTask.sync\",\"Parameters\":{\"Cluster\":\"",{"Fn::GetAtt":["ValidationClusterC8915CA8","Arn"]},"\",\"TaskDefinition\":\"ValidationPipelineStackMCPServerTaskDef80539BDE\",\"NetworkConfiguration\":{\"AwsvpcConfiguration\":{\"AssignPublicIp\":\"ENABLED\",\"Subnets\":[\"",{"Ref":"ValidationVpcPublicSubnet1Subnet77950CB6"},"\",\"",{"Ref":"ValidationVpcPublicSubnet2Subnet533BB13F"},"\"],\"SecurityGroups\":[\"",{"Fn::GetAtt":["EcsSecurityGroup44008BF1","GroupId"]},"\"]}},\"Overrides\":{\"ContainerOverrides\":[{\"Name\":\"MCPServerContainer\",\"Environment\":[{\"Name\":\"IMAGE_URI\",\"Value.$\":\"$.imageDetails.imageUri\"}]}]},\"LaunchType\":\"FARGATE\",\"PlatformVersion\":\"LATEST\"}},\"ValidateMCPServer\":{\"Next\":\"StopMCPServerContainer\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"ResultPath\":\"$.validationResult\",\"Resource\":\"",{"Fn::GetAtt":["ValidationFunctionB150DCA9","Arn"]},"\",\"Parameters\":{\"serverId.$\":\"$.serverId\",\"endpoint.$\":\"$.taskResult.Attachments[0].Details[?(@.Name == \\\"networkConfiguration\\\")].Value.NetworkInterfaces[0].PublicIp\",\"taskArn.$\":\"$.taskResult.TaskArn\"}},\"StopMCPServerContainer\":{\"Next\":\"CheckValidationResult\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"ResultPath\":\"$.cleanupResult\",\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"",{"Fn::GetAtt":["StopTaskFunction11473A8C","Arn"]},"\",\"Payload\":{\"taskArn.$\":\"$.taskResult.TaskArn\"}}},\"CheckValidationResult\":{\"Type\":\"Choice\",\"Choices\":[{\"Variable\":\"$.validationResult.body.verified\",\"BooleanEquals\":true,\"Next\":\"ValidationSucceeded\"}],\"Default\":\"ValidationFailed\"},\"ValidationFailed\":{\"Type\":\"Fail\",\"Error\":\"ServerValidationError\",\"Cause\":\"MCP server validation failed\"},\"ValidationSucceeded\":{\"Type\":\"Succeed\"}},\"TimeoutSeconds\":1800}"]]},"roleArn":{"Fn::GetAtt":["ValidationPipelineRole502F3E50","Arn"]},"stateMachineName":"ToolShed-MCP-Server-Validation-Pipeline","tracingConfiguration":{"enabled":true}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.CfnStateMachine","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.StateMachine","version":"2.189.0","metadata":[]}},"StateMachineArn":{"id":"StateMachineArn","path":"ValidationPipelineStack/StateMachineArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.189.0"}},"EcrRepositoryUri":{"id":"EcrRepositoryUri","path":"ValidationPipelineStack/EcrRepositoryUri","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.189.0"}},"EcsClusterName":{"id":"EcsClusterName","path":"ValidationPipelineStack/EcsClusterName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.189.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"ValidationPipelineStack/CDKMetadata","children":{"Default":{"id":"Default","path":"ValidationPipelineStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.189.0"}}},"constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}},"BootstrapVersion":{"id":"BootstrapVersion","path":"ValidationPipelineStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.189.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"ValidationPipelineStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.189.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.189.0"}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}},"constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.189.0"}}}